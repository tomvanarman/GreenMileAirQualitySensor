# SIM7080G – Hardware Guide

This page documents how the SIMCom SIM7080G cellular module is powered, connected, and validated in
this project. It complements the datasheet and hardware design resources from the vendor:

-   Product page: https://www.simcom.com/product/SIM7080G.html
-   Reference manuals and AT command set: see downloads on the product page.

The SIM7080G is a low‑power LTE Cat‑M1/NB‑IoT + GNSS module. In this project it is mounted on a
board with an AXP2101 PMU and is controlled by an ESP32.

## Module capabilities (project-relevant)

-   LTE Cat‑M1 and NB‑IoT with global bands (board/SIM dependent).
-   Packet data over IP (APN required).
-   TCP/UDP/HTTP(S) stacks on-module.
-   GNSS (GPS/GLONASS/BeiDou/Galileo/QZSS) with active antenna power rail available on the board.
-   Diagnostic AT commands for registration, signal, bearer activation, and ping.

## Hardware integration

### Power tree (AXP2101 PMU)

The PMU powers the modem and GNSS rails. The firmware configures:

-   DC3 = 3.0 V → main SIM7080G supply (per project code).
-   BLDO2 = 3.3 V → GNSS antenna bias (enable for GNSS use).
-   TS pin measurement disabled to allow battery charging.

These settings are applied in code:

-   DC3 enabled at 3.0 V.
-   BLDO2 enabled at 3.3 V.
-   T_SENSE measurement disabled.

Notes:

-   Ensure the 3.0 V rail can supply modem peaks (hundreds of mA during Tx bursts).
-   Keep supply decoupling capacitors close to the module as per SIMCom hardware design guide.
-   Use a good ground plane; minimize supply and RF return path impedance.

### ESP32 connections (typical)

-   UART: ESP32 Serial1 (TXD/RXD) → SIM7080G UART0 (115200 8N1).
-   PWRKEY: GPIO → controls modem power-on sequence (low pulse >1 s).
-   DTR: GPIO → sleep control (optional; keep defined).
-   RI: GPIO input → ring indicator (optional).
-   I2C: SDA/SCL → AXP2101 PMU control.
-   GNSS antenna power: provided by BLDO2 (3.3 V) on the board (enable only when needed).

Exact pin numbers are board-specific. See your board header/pinmap for:

-   BOARD_MODEM_TXD_PIN / BOARD_MODEM_RXD_PIN
-   BOARD_MODEM_PWR_PIN / BOARD_MODEM_DTR_PIN / BOARD_MODEM_RI_PIN
-   I2C_SDA / I2C_SCL

### Antennas

-   Main LTE antenna: required for cellular connectivity.
-   GNSS antenna: required for GNSS; enable BLDO2 to power active antennas.
-   Keep antenna connectors tight; route coax away from noisy digital lines.

### SIM card

-   Use a Cat‑M1/NB‑IoT capable SIM (e.g., 1NCE).
-   APN must be set (project uses APN: iot.1nce.net).
-   Verify SIM presence with AT+CPIN? and TinyGSM getSimStatus().

## Power‑on and bring‑up sequence

1. PMU init:

    - Initialize AXP2101 over I2C.
    - Disable TS pin measurement.
    - Enable DC3 (3.0 V) for modem.
    - Enable BLDO2 (3.3 V) only if GNSS is needed.

2. Modem start:

    - Configure UART (115200 8N1).
    - Pulse PWRKEY: low >1 s to boot the module.
    - Wait for AT responsiveness (test with AT).

3. Network setup:
    - CFUN=0 (RF off), set network and preferred mode (Cat‑M1 by default).
    - Set APN with CGDCONT.
    - CFUN=1 (RF on), wait for registration (home or roaming).
    - Configure PDP profile with CNCFG, then activate with CNACT=0,1.
    - Optionally enable local time sync CLTS and read CCLK.

These steps are automated by SIM7080::initialize(), ::start(), ::setupNetwork().

## Software dependencies (project)

-   TinyGSM (SIM7080 profile): UART/AT management and helpers.
-   XPowersLib (AXP2101): PMU control for rails and charging.
-   Arduino framework on ESP32.

## Validation and diagnostics

Use these checks to validate hardware wiring and the RF path:

-   Modem alive:
    -   AT → OK
-   SIM ready:
    -   AT+CPIN? → READY
-   Registration:
    -   AT+CEREG? (LTE attach), AT+CGREG? or AT+CREG? → registered (home/roaming)
-   Operator and RAT:
    -   AT+COPS? → operator, RAT (Cat‑M1/NB)
-   Signal quality:
    -   AT+CSQ → RSSI BER (e.g., 10–20 typical indoors on Cat‑M1)
-   PDP/bearer:
    -   AT+CNACT? → state 1 when active, show IP address
-   Ping:
    -   AT+SNPING4="8.8.8.8",1,3000,32 → verify IP reachability

The project emits structured logs during these steps. Use the serial monitor at 115200 baud.

## Project criteria mapping

-   “The CMB can connect to the internet using an LTE network.”

    -   Achieved by SIM7080::setupNetwork() (APN, registration, bearer activation). Requires antenna
        and coverage.

-   “The SIM7080G module can ping 8.8.8.8.”

    -   Supported via AT+SNPING4. Add a small helper in code or issue the command from a debug
        console after CNACT=0,1.

-   “The connection automatically re‑establishes after loss of signal or restart.”

    -   Use SIM7080::ensureConnected() periodically. It re‑runs setup when GPRS/bearer is down.

-   “The connection status is visible or logged for diagnostics.”

    -   Logs include SIM status, registration, bearer state, HTTPS transactions. Add periodic
        CSQ/CNACT logging if needed.

-   “Documentation is created on the relevant page.”
    -   This page provides the hardware overview, wiring, bring‑up, and validation steps.

## Quick test procedure

1. Power and boot:

    - Observe “Power chip initialized” and “Modem started” on serial logs.

2. SIM and registration:

    - Check “Registered, home network” or “Registered, roaming”.
    - If it times out, verify antenna/SIM and coverage.

3. Bearer activation:

    - Confirm “GPRS status: connected” and CNACT? returns an IP.

4. Ping test (optional):

    - Send AT+SNPING4="8.8.8.8",1,3000,32
    - Expect a response line “+SNPING4:…” with RTT and success.

5. HTTPS test:
    - The sample app posts JSON to the configured server.
    - Check SHCONN/SHREQ logs and server-side receipt.

    A. Data queueing
        - Shut down the docker container or disconnect the antenna.
        - Observe “Failed to post data” logs and data being queued.
    
    B. Recovery
        - Restore connectivity.
        - Observe queued data being sent successfully.

## Troubleshooting

-   No AT responses:
    -   Check UART wiring, baud rate, PWRKEY timing, PMU rails (DC3 enabled at 3.0 V).
-   Not registered:
    -   Verify SIM/APN, antenna, coverage for Cat‑M1/NB‑IoT. Try alternative RAT (NB) or band scan.
-   Bearer won’t activate:
    -   Recheck APN (CGDCONT + CNCFG), ensure CFUN=1 and module registered. Power cycle if needed.
-   Weak signal:
    -   Check CSQ; improve antenna placement, use proper ground clearance, move outdoors.
-   HTTPS failures:
    -   Verify time sync (CLTS/CCLK), SNI configuration, and server TLS compatibility.

## Safety and RF notes

-   Keep antennas away from users or sensitive analog circuits during Tx.
-   Follow local regulations for LTE/NB‑IoT operation and bands.
-   Use ESD precautions when handling RF connectors.

## References

-   SIM7080G Product page and downloads: https://www.simcom.com/product/SIM7080G.html
-   SIMCom SIM7080 Series AT Command Manual (from product page)
-   SIMCom Hardware Design Guide for SIM7080 series
-   TinyGSM library docs (SIM7080 profile)
